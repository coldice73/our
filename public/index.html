<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: #333;
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--primary);
        }

        .sidebar {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            min-height: calc(100vh - 56px);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            margin: 4px 0;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
            margin-bottom: 20px;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background-color: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0 !important;
        }

        .stats-card {
            text-align: center;
            padding: 20px;
        }

        .stats-card .number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .stats-card .label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .video-card {
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail {
            height: 180px;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }

        .video-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-uploading {
            background: #fff3cd;
            color: #856404;
        }

        .status-processing {
            background: #cce7ff;
            color: #004085;
        }

        .status-ready {
            background: #d1edff;
            color: #0c5460;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .analysis-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }

        .progress {
            height: 8px;
            border-radius: 4px;
        }

        .analysis-type-card {
            cursor: pointer;
            transition: all 0.3s;
        }

        .analysis-type-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .analysis-result {
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none !important;
        }

        #videoPlayer {
            width: 100%;
            border-radius: 8px;
        }

        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary);
            background: #e9f2ff;
        }

        .tab-content {
            padding: 20px 0;
        }

        .nav-tabs .nav-link.active {
            font-weight: 600;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .video-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .video-player-wrapper {
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }

        .video-player-wrapper video {
            width: 100%;
            height: auto;
            max-height: 300px;
        }

        .video-player-title {
            padding: 10px;
            background: var(--dark);
            color: white;
            text-align: center;
            font-weight: 600;
        }

        /* æ·»åŠ ä¸Šä¼ ä¿æŠ¤æ ·å¼ */
        .upload-protection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 18px;
        }

        .upload-protection-message {
            text-align: center;
            max-width: 500px;
            padding: 20px;
        }

        .upload-protection-progress {
            width: 300px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .upload-protection-progress-bar {
            height: 100%;
            background: #4361ee;
            transition: width 0.3s ease;
        }

        .upload-cancel-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .upload-cancel-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .video-comparison {
                grid-template-columns: 1fr;
            }
        }

        /* æ·»åŠ è¡¨æ ¼æ ·å¼ */
        #detailedAnalysisTable {
            font-size: 0.85rem;
        }

        #detailedAnalysisTable th {
            font-weight: 600;
        }

        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="container">
        <div class="login-container">
            <h2 class="text-center mb-4">æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°</h2>
            <ul class="nav nav-tabs mb-4" id="authTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login"
                        type="button" role="tab">ç™»å½•</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register"
                        type="button" role="tab">æ³¨å†Œ</button>
                </li>
            </ul>
            <div class="tab-content" id="authTabsContent">
                <div class="tab-pane fade show active" id="login" role="tabpanel">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">ç”¨æˆ·å</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">å¯†ç </label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">ç™»å½•</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="register" role="tabpanel">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerUsername" class="form-label">ç”¨æˆ·å</label>
                            <input type="text" class="form-control" id="registerUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">é‚®ç®±</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">å¯†ç </label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">æ³¨å†Œ</button>
                    </form>
                </div>
            </div>
            <div id="authMessage" class="mt-3"></div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨é¡µé¢ -->
    <div id="appPage" class="hidden">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-video me-2"></i>æ™ºèƒ½è§†é¢‘åˆ†æå¹³å°
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i> <span id="currentUser">ç”¨æˆ·</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" id="profileBtn"><i
                                            class="fas fa-user me-2"></i>ä¸ªäººèµ„æ–™</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i
                                            class="fas fa-sign-out-alt me-2"></i>é€€å‡ºç™»å½•</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- ä¾§è¾¹æ  -->
                <div class="col-md-3 col-lg-2 sidebar p-0">
                    <div class="d-flex flex-column flex-shrink-0 p-3">
                        <ul class="nav nav-pills flex-column mb-auto">
                            <li class="nav-item">
                                <a href="#" class="nav-link active" data-page="dashboard">
                                    <i class="fas fa-tachometer-alt"></i> æ¬¢è¿ä½¿ç”¨
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-page="upload">
                                    <i class="fas fa-upload"></i> ä¸Šä¼ è§†é¢‘
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-page="videos">
                                    <i class="fas fa-play-circle"></i> è§†é¢‘åº“
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-page="analysis">
                                    <i class="fas fa-chart-bar"></i> è§†é¢‘åˆ†æ
                                </a>
                            </li>
                            <li>
                                <a href="#" class="nav-link" data-page="qwenAnalysis">
                                    <i class="fas fa-robot"></i> AIæ™ºèƒ½åˆ†æ
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- ä¸»å†…å®¹åŒº -->
                <div class="col-md-9 col-lg-10 ml-sm-auto px-4 py-4">
                    <!-- ä»ªè¡¨æ¿é¡µé¢ -->
                    <div id="dashboardPage" class="page-content">
                        <h2 class="mb-4">ç³»ç»Ÿæ¦‚è§ˆ</h2>

                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <i class="fas fa-video fa-2x text-primary mb-2"></i>
                                        <div class="number" id="totalVideos">0</div>
                                        <div class="label">æ€»è§†é¢‘æ•°</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                        <div class="number" id="analyzedVideos">0</div>
                                        <div class="label">å·²åˆ†æè§†é¢‘</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <i class="fas fa-sync-alt fa-2x text-warning mb-2"></i>
                                        <div class="number" id="processingVideos">0</div>
                                        <div class="label">å¤„ç†ä¸­è§†é¢‘</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <i class="fas fa-users fa-2x text-info mb-2"></i>
                                        <div class="number" id="totalUsers">0</div>
                                        <div class="label">ç”¨æˆ·æ€»æ•°</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        æœ€è¿‘ä¸Šä¼ çš„è§†é¢‘
                                    </div>
                                    <div class="card-body">
                                        <div id="recentVideosList"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        ç³»ç»Ÿå¥åº·çŠ¶æ€
                                    </div>
                                    <div class="card-body">
                                        <div id="systemHealth"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸Šä¼ è§†é¢‘é¡µé¢ -->
                    <div id="uploadPage" class="page-content hidden">
                        <h2 class="mb-4">ä¸Šä¼ è§†é¢‘</h2>

                        <div class="card">
                            <div class="card-header">
                                è§†é¢‘ä¸Šä¼ 
                            </div>
                            <div class="card-body">
                                <div class="upload-area" id="uploadArea">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <h5>æ‹–æ”¾è§†é¢‘æ–‡ä»¶åˆ°è¿™é‡Œ</h5>
                                    <p class="text-muted">æ”¯æŒ MP4, AVI, MOV, MKV, WEBM æ ¼å¼ï¼Œæœ€å¤§ 2GB</p>
                                    <button class="btn btn-primary mt-2" id="browseBtn">é€‰æ‹©æ–‡ä»¶</button>
                                    <input type="file" id="fileInput" class="d-none" accept="video/*">
                                </div>

                                <div id="uploadForm" class="mt-4 hidden">
                                    <div class="mb-3">
                                        <label for="videoTitle" class="form-label">è§†é¢‘æ ‡é¢˜</label>
                                        <input type="text" class="form-control" id="videoTitle">
                                    </div>
                                    <div class="mb-3">
                                        <label for="videoDescription" class="form-label">è§†é¢‘æè¿°</label>
                                        <textarea class="form-control" id="videoDescription" rows="3"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">é€‰ä¸­çš„æ–‡ä»¶</label>
                                        <div id="selectedFileInfo" class="p-2 bg-light rounded"></div>
                                    </div>
                                    <button class="btn btn-primary" id="startUploadBtn">å¼€å§‹ä¸Šä¼ </button>
                                </div>

                                <div id="uploadProgress" class="mt-4 hidden">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>ä¸Šä¼ è¿›åº¦</span>
                                        <span id="progressPercent">0%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%">
                                        </div>
                                    </div>
                                    <div id="uploadStatus" class="mt-2"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header">
                                æˆ‘çš„ä¸Šä¼ è®°å½•
                            </div>
                            <div class="card-body">
                                <div id="myUploadsList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- è§†é¢‘åº“é¡µé¢ -->
                    <div id="videosPage" class="page-content hidden">
                        <h2 class="mb-4">è§†é¢‘åº“</h2>

                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>æ‰€æœ‰è§†é¢‘</span>
                                <div>
                                    <input type="text" class="form-control form-control-sm d-inline-block w-auto"
                                        id="searchVideos" placeholder="æœç´¢è§†é¢‘...">
                                    <select class="form-select form-select-sm d-inline-block w-auto ms-2"
                                        id="filterStatus">
                                        <option value="">æ‰€æœ‰çŠ¶æ€</option>
                                        <option value="uploading">ä¸Šä¼ ä¸­</option>
                                        <option value="processing">å¤„ç†ä¸­</option>
                                        <option value="ready">å°±ç»ª</option>
                                        <option value="error">é”™è¯¯</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row" id="videosList"></div>
                            </div>
                        </div>
                    </div>

                    <!-- è§†é¢‘åˆ†æé¡µé¢ -->
                    <div id="analysisPage" class="page-content hidden">
                        <h2 class="mb-4">è§†é¢‘åˆ†æ</h2>

                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        è§†é¢‘å¯¹æ¯”
                                    </div>
                                    <div class="card-body">
                                        <div class="video-comparison" id="videoComparison">
                                            <!-- è§†é¢‘å¯¹æ¯”å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                        </div>
                                        <div id="analysisControls" class="mt-3">
                                            <button class="btn btn-primary me-2" id="triggerAnalysisBtn">å¼€å§‹åˆ†æ</button>
                                            <button class="btn btn-info me-2"
                                                id="checkAnalysisStatusBtn">æ£€æŸ¥åˆ†æçŠ¶æ€</button>
                                            <button class="btn btn-warning me-2" id="importAnalysisBtn">å¯¼å…¥åˆ†æç»“æœ</button>
                                            <button class="btn btn-secondary" id="copyDatabaseBtn">å¤åˆ¶åˆ†ææ•°æ®åº“</button>
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar" id="analysisProgressBar" role="progressbar"
                                                style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">
                                        åˆ†æç»“æœè¯¦æƒ…
                                    </div>
                                    <div class="card-body">
                                        <div id="analysisDetail">
                                            <!-- æ–°å¢çš„è¯¦ç»†åˆ†æç»“æœè¡¨æ ¼ -->
                                            <div class="mt-4">
                                                <h6>è¯¦ç»†åˆ†æç»“æœ</h6>
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-sm"
                                                        id="detailedAnalysisTable">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>ç»„ä»¶åç§°</th>
                                                                <th>å¼€å§‹å¸§</th>
                                                                <th>æŒç»­æ—¶é—´</th>
                                                                <th>ç»“æŸå¸§</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="detailedAnalysisBody">
                                                            <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="mt-2">
                                                    <p><strong>è§†é¢‘ä¿¡æ¯:</strong> å¸§ç‡: <span id="analysisFPS">0</span> fps,
                                                        æ€»å¸§æ•°: <span id="analysisTotalFrames">0</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        åˆ†æçŠ¶æ€
                                    </div>
                                    <div class="card-body">
                                        <div id="analysisStatusList"></div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">
                                        åˆ†æç»Ÿè®¡
                                    </div>
                                    <div class="card-body">
                                        <div id="analysisStats"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AIæ™ºèƒ½åˆ†æé¡µé¢ -->
                    <div id="qwenAnalysisPage" class="page-content hidden">
                        <h2 class="mb-4">AIæ™ºèƒ½åˆ†æ (QwenAI)</h2>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        é€‰æ‹©åˆ†æç±»å‹
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="analysisTypeSelect" class="form-label">åˆ†æç±»å‹</label>
                                            <select class="form-select" id="analysisTypeSelect">
                                                <option value="summary">å†…å®¹æ€»ç»“</option>
                                                <option value="medical">åŒ»å­¦åˆ†æ</option>
                                                <option value="technical">æŠ€æœ¯åˆ†æ</option>
                                                <option value="educational">æ•™è‚²ä»·å€¼</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">
                                        é€‰æ‹©è§†é¢‘
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="qwenVideoSelect" class="form-label">å·²åˆ†æå®Œæˆçš„è§†é¢‘</label>
                                            <select class="form-select" id="qwenVideoSelect"></select>
                                        </div>
                                        <button class="btn btn-primary w-100" id="startQwenAnalysisBtn">å¼€å§‹AIåˆ†æ</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        AIåˆ†æç»“æœ
                                    </div>
                                    <div class="card-body">
                                        <div id="qwenAnalysisResult"></div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">
                                        æ‰¹é‡åˆ†æ
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted">é€‰æ‹©åˆ†æç±»å‹ï¼Œå¯¹æ‚¨æ‰€æœ‰å·²åˆ†æå®Œæˆçš„è§†é¢‘è¿›è¡Œæ‰¹é‡AIåˆ†æã€‚</p>
                                        <div class="mb-3">
                                            <label for="batchAnalysisType" class="form-label">åˆ†æç±»å‹</label>
                                            <select class="form-select" id="batchAnalysisType">
                                                <option value="summary">å†…å®¹æ€»ç»“</option>
                                                <option value="medical">åŒ»å­¦åˆ†æ</option>
                                                <option value="technical">æŠ€æœ¯åˆ†æ</option>
                                                <option value="educational">æ•™è‚²ä»·å€¼</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-info w-100" id="startBatchAnalysisBtn">å¼€å§‹æ‰¹é‡åˆ†æ</button>
                                        <div id="batchAnalysisProgress" class="mt-3 hidden"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è§†é¢‘æ’­æ”¾æ¨¡æ€æ¡† -->
    <div class="modal fade" id="videoModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="videoModalTitle">è§†é¢‘æ’­æ”¾</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="video-comparison">
                        <div class="video-player-wrapper">
                            <div class="video-player-title">åŸå§‹è§†é¢‘</div>
                            <video id="originalVideoPlayer" controls>
                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                            </video>
                        </div>
                        <div class="video-player-wrapper">
                            <div class="video-player-title">åˆ†æåè§†é¢‘</div>
                            <video id="annotatedVideoPlayer" controls>
                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                            </video>
                        </div>
                    </div>
                    <div id="videoInfo" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸Šä¼ ä¿æŠ¤å±‚ -->
    <div id="uploadProtection" class="upload-protection-overlay hidden">
        <div class="upload-protection-message">
            <h3>ğŸ“¤ æ–‡ä»¶ä¸Šä¼ ä¸­...</h3>
            <p>è¯·ä¸è¦å…³é—­é¡µé¢æˆ–åˆ·æ–°æµè§ˆå™¨ï¼Œå¦åˆ™ä¸Šä¼ ä¼šä¸­æ–­</p>
            <div class="upload-protection-progress">
                <div id="uploadProtectionProgress" class="upload-protection-progress-bar" style="width: 0%"></div>
            </div>
            <p>å·²ä¸Šä¼ : <span id="uploadProtectionPercent">0%</span></p>
            <p>ä¸Šä¼ é€Ÿåº¦: <span id="uploadSpeed">0 KB/s</span></p>
            <p>é¢„è®¡å‰©ä½™æ—¶é—´: <span id="uploadRemainingTime">è®¡ç®—ä¸­...</span></p>
            <button id="uploadCancelBtn" class="upload-cancel-btn">å–æ¶ˆä¸Šä¼ </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        const API_BASE = 'http://localhost:3000/api';
        let currentUser = null;
        let authToken = null;
        let currentVideo = null;
        let analysisInterval = null;

        // ä¸Šä¼ çŠ¶æ€ç®¡ç†
        let uploadState = {
            isUploading: false,
            currentProgress: 0,
            startTime: null,
            uploadedBytes: 0,
            totalBytes: 0,
            xhr: null,
            currentFilename: null
        };

        // DOM åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            checkAuthStatus();

            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEvents();

            // åˆå§‹åŒ–ä¸Šä¼ ä¿æŠ¤
            setupUploadProtection();
        });

        // è®¾ç½®ä¸Šä¼ ä¿æŠ¤æœºåˆ¶
        function setupUploadProtection() {
            const beforeUnloadHandler = (event) => {
                if (uploadState.isUploading) {
                    event.preventDefault();
                    event.returnValue = 'æ–‡ä»¶æ­£åœ¨ä¸Šä¼ ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿä¸Šä¼ è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚';
                    return event.returnValue;
                }
            };

            const unloadHandler = () => {
                if (uploadState.isUploading && uploadState.xhr) {
                    // å°è¯•å–æ¶ˆä¸Šä¼ 
                    uploadState.xhr.abort();

                    // å‘é€å–æ¶ˆè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ˆå¦‚æœæœåŠ¡å™¨æ”¯æŒï¼‰
                    try {
                        navigator.sendBeacon(`${API_BASE}/upload/cancel`, JSON.stringify({
                            filename: uploadState.currentFilename,
                            uploadedBytes: uploadState.uploadedBytes
                        }));
                    } catch (e) {
                        console.log('æ— æ³•å‘é€å–æ¶ˆè¯·æ±‚:', e);
                    }
                }
            };

            window.addEventListener('beforeunload', beforeUnloadHandler);
            window.addEventListener('unload', unloadHandler);
            window.addEventListener('pagehide', unloadHandler);

            // è¿”å›æ¸…ç†å‡½æ•°
            return () => {
                window.removeEventListener('beforeunload', beforeUnloadHandler);
                window.removeEventListener('unload', unloadHandler);
                window.removeEventListener('pagehide', unloadHandler);
            };
        }

        // æ˜¾ç¤ºä¸Šä¼ ä¿æŠ¤å±‚
        function showUploadProtection() {
            const protectionLayer = document.getElementById('uploadProtection');
            protectionLayer.classList.remove('hidden');
            uploadState.isUploading = true;
            uploadState.startTime = Date.now();

            // ç¦ç”¨æ‰€æœ‰å¯¼èˆªé“¾æ¥å’ŒæŒ‰é’®
            document.querySelectorAll('a, button').forEach(element => {
                if (element.id !== 'uploadCancelBtn') {
                    element.style.pointerEvents = 'none';
                    element.style.opacity = '0.5';
                }
            });
        }

        // éšè—ä¸Šä¼ ä¿æŠ¤å±‚
        function hideUploadProtection() {
            const protectionLayer = document.getElementById('uploadProtection');
            protectionLayer.classList.add('hidden');
            uploadState.isUploading = false;
            uploadState.xhr = null;

            // æ¢å¤æ‰€æœ‰å¯¼èˆªé“¾æ¥å’ŒæŒ‰é’®
            document.querySelectorAll('a, button').forEach(element => {
                element.style.pointerEvents = '';
                element.style.opacity = '';
            });
        }

        // æ›´æ–°ä¸Šä¼ ä¿æŠ¤è¿›åº¦
        function updateUploadProtection(percent, uploadedBytes, totalBytes) {
            uploadState.currentProgress = percent;
            uploadState.uploadedBytes = uploadedBytes;
            uploadState.totalBytes = totalBytes;

            const progressBar = document.getElementById('uploadProtectionProgress');
            const percentText = document.getElementById('uploadProtectionPercent');
            const speedText = document.getElementById('uploadSpeed');
            const timeText = document.getElementById('uploadRemainingTime');

            progressBar.style.width = percent + '%';
            percentText.textContent = Math.round(percent) + '%';

            // è®¡ç®—ä¸Šä¼ é€Ÿåº¦
            const elapsedTime = (Date.now() - uploadState.startTime) / 1000; // ç§’
            if (elapsedTime > 0) {
                const speed = uploadedBytes / elapsedTime / 1024; // KB/s
                speedText.textContent = speed.toFixed(2) + ' KB/s';

                // è®¡ç®—å‰©ä½™æ—¶é—´
                const remainingBytes = totalBytes - uploadedBytes;
                const remainingTime = remainingBytes / (speed * 1024); // ç§’

                if (remainingTime > 0) {
                    if (remainingTime < 60) {
                        timeText.textContent = Math.ceil(remainingTime) + 'ç§’';
                    } else if (remainingTime < 3600) {
                        timeText.textContent = Math.ceil(remainingTime / 60) + 'åˆ†é’Ÿ';
                    } else {
                        timeText.textContent = Math.ceil(remainingTime / 3600) + 'å°æ—¶';
                    }
                } else {
                    timeText.textContent = 'è®¡ç®—ä¸­...';
                }
            }
        }

        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('currentUser');

            if (token && user) {
                authToken = token;
                currentUser = JSON.parse(user);
                showAppPage();
            } else {
                showLoginPage();
            }
        }

        // æ˜¾ç¤ºç™»å½•é¡µé¢
        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('appPage').classList.add('hidden');
        }

        // æ˜¾ç¤ºåº”ç”¨é¡µé¢
        function showAppPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('appPage').classList.remove('hidden');
            document.getElementById('currentUser').textContent = currentUser.username;

            // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
            loadDashboardData();
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // ç™»å½•è¡¨å•
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);

            // å¯¼èˆªèœå•
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();

                    // æ›´æ–°æ´»åŠ¨èœå•é¡¹
                    document.querySelectorAll('.sidebar .nav-link').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');

                    // æ˜¾ç¤ºå¯¹åº”é¡µé¢
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // é€€å‡ºç™»å½•
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // ä¸Šä¼ ç›¸å…³
            document.getElementById('browseBtn').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });

            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('startUploadBtn').addEventListener('click', startUpload);

            // å–æ¶ˆä¸Šä¼ æŒ‰é’®
            document.getElementById('uploadCancelBtn').addEventListener('click', function () {
                if (uploadState.xhr) {
                    uploadState.xhr.abort();
                    hideUploadProtection();
                    showMessage('ä¸Šä¼ å·²å–æ¶ˆ', 'warning');
                }
            });

            // æ‹–æ”¾ä¸Šä¼ 
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');

                if (e.dataTransfer.files.length) {
                    document.getElementById('fileInput').files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });

            // åˆ†æç›¸å…³
            document.getElementById('triggerAnalysisBtn').addEventListener('click', triggerAnalysis);
            document.getElementById('checkAnalysisStatusBtn').addEventListener('click', checkAnalysisStatus);
            document.getElementById('importAnalysisBtn').addEventListener('click', importAnalysis);
            document.getElementById('copyDatabaseBtn').addEventListener('click', copyAnalysisDatabase);

            // AIåˆ†æç›¸å…³
            document.getElementById('startQwenAnalysisBtn').addEventListener('click', startQwenAnalysis);
            document.getElementById('startBatchAnalysisBtn').addEventListener('click', startBatchAnalysis);

            // æœç´¢å’Œç­›é€‰
            document.getElementById('searchVideos').addEventListener('input', loadVideos);
            document.getElementById('filterStatus').addEventListener('change', loadVideos);
        }

        // æ˜¾ç¤ºé¡µé¢
        function showPage(pageName) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });

            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(`${pageName}Page`).classList.remove('hidden');

            // åŠ è½½é¡µé¢æ•°æ®
            switch (pageName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'upload':
                    loadMyUploads();
                    break;
                case 'videos':
                    loadVideos();
                    break;
                case 'analysis':
                    loadAnalysisPage();
                    break;
                case 'qwenAnalysis':
                    loadQwenAnalysisPage();
                    break;
            }
        }

        // API è°ƒç”¨å‡½æ•°
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;

            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            // æ·»åŠ è®¤è¯ä»¤ç‰Œ
            if (authToken) {
                defaultOptions.headers['Authorization'] = `Bearer ${authToken}`;
            }

            const finalOptions = { ...defaultOptions, ...options };

            try {
                const response = await fetch(url, finalOptions);

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: `HTTPé”™è¯¯: ${response.status}` }));
                    throw new Error(errorData.error || `APIé”™è¯¯: ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
                showMessage(error.message, 'error');
                throw error;
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const alertClass = type === 'error' ? 'alert-danger' :
                type === 'success' ? 'alert-success' : 'alert-info';

            // åœ¨ç™»å½•é¡µé¢æ˜¾ç¤º
            const authMessage = document.getElementById('authMessage');
            if (authMessage) {
                authMessage.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            }

            // åœ¨ä¸»åº”ç”¨é¡µé¢æ˜¾ç¤ºï¼ˆå¯ä»¥æ‰©å±•ä¸ºtoasté€šçŸ¥ï¼‰
            console.log(`${type.toUpperCase()}: ${message}`);
        }

        // ç™»å½•å¤„ç†
        async function handleLogin(e) {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const data = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                authToken = data.token;
                currentUser = data.user;

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showAppPage();
                showMessage('ç™»å½•æˆåŠŸ!', 'success');
            } catch (error) {
                showMessage('ç™»å½•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ³¨å†Œå¤„ç†
        async function handleRegister(e) {
            e.preventDefault();

            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const data = await apiCall('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, email, password })
                });

                showMessage('æ³¨å†ŒæˆåŠŸ! è¯·ç™»å½•ã€‚', 'success');

                // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
                document.getElementById('login-tab').click();

                // æ¸…ç©ºè¡¨å•
                document.getElementById('registerForm').reset();
            } catch (error) {
                showMessage('æ³¨å†Œå¤±è´¥: ' + error.message, 'error');
            }
        }

        // é€€å‡ºç™»å½•
        function handleLogout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            authToken = null;
            currentUser = null;
            showLoginPage();
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        function handleFileSelect() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) return;

            // éªŒè¯æ–‡ä»¶ç±»å‹
            const allowedTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/mkv', 'video/webm'];
            if (!allowedTypes.includes(file.type)) {
                showMessage('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ' + file.type, 'error');
                return;
            }

            // éªŒè¯æ–‡ä»¶å¤§å° (2GB)
            const maxSize = 2 * 1024 * 1024 * 1024;
            if (file.size > maxSize) {
                showMessage('æ–‡ä»¶å¤ªå¤§ï¼Œæœ€å¤§æ”¯æŒ2GB', 'error');
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯å’Œä¸Šä¼ è¡¨å•
            document.getElementById('selectedFileInfo').innerHTML = `
                <strong>${file.name}</strong> (${formatFileSize(file.size)})
            `;

            // è®¾ç½®é»˜è®¤æ ‡é¢˜
            const title = file.name.replace(/\.[^/.]+$/, ""); // ç§»é™¤æ‰©å±•å
            document.getElementById('videoTitle').value = title;

            document.getElementById('uploadForm').classList.remove('hidden');
        }

        // å¼€å§‹ä¸Šä¼ 
        async function startUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;

            if (!file) {
                showMessage('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
                return;
            }

            // æ˜¾ç¤ºä¸Šä¼ ä¿æŠ¤
            showUploadProtection();

            // å‡†å¤‡ä¸Šä¼ 
            document.getElementById('uploadForm').classList.add('hidden');
            document.getElementById('uploadProgress').classList.remove('hidden');

            const formData = new FormData();
            formData.append('video', file);
            formData.append('title', title);
            formData.append('description', description);

            try {
                const xhr = new XMLHttpRequest();
                uploadState.xhr = xhr;
                uploadState.currentFilename = file.name;
                uploadState.totalBytes = file.size;

                // ä¸Šä¼ è¿›åº¦ - å¢å¼ºç‰ˆ
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        updateUploadProgress(percentComplete, 'ä¸Šä¼ ä¸­...');
                        updateUploadProtection(percentComplete, e.loaded, e.total);
                    }
                });

                // ä¸Šä¼ å®Œæˆ
                xhr.addEventListener('load', () => {
                    hideUploadProtection();

                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        updateUploadProgress(100, 'ä¸Šä¼ å®Œæˆ!');
                        showMessage('è§†é¢‘ä¸Šä¼ æˆåŠŸ!', 'success');

                        // é‡ç½®è¡¨å•
                        setTimeout(() => {
                            document.getElementById('uploadForm').classList.add('hidden');
                            document.getElementById('uploadProgress').classList.add('hidden');
                            document.getElementById('fileInput').value = '';
                            document.getElementById('uploadForm').reset();

                            // åˆ·æ–°ä¸Šä¼ åˆ—è¡¨
                            loadMyUploads();
                        }, 2000);
                    } else {
                        const error = JSON.parse(xhr.responseText);
                        showMessage('ä¸Šä¼ å¤±è´¥: ' + error.error, 'error');
                    }
                });

                // ä¸Šä¼ é”™è¯¯
                xhr.addEventListener('error', () => {
                    hideUploadProtection();
                    showMessage('ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'error');
                });

                // ä¸Šä¼ ä¸­æ­¢
                xhr.addEventListener('abort', () => {
                    hideUploadProtection();
                    showMessage('ä¸Šä¼ å·²å–æ¶ˆ', 'warning');
                });

                xhr.open('POST', `${API_BASE}/upload`);
                xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
                xhr.send(formData);

            } catch (error) {
                hideUploadProtection();
                showMessage('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ›´æ–°ä¸Šä¼ è¿›åº¦
        function updateUploadProgress(percent, status) {
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(percent)}%`;
            document.getElementById('uploadStatus').textContent = status;
        }

        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                // è·å–è§†é¢‘ç»Ÿè®¡
                const statsResponse = await apiCall('/videos/stats/status');
                document.getElementById('totalVideos').textContent = statsResponse.total || 0;
                document.getElementById('analyzedVideos').textContent = statsResponse.byAnalysisStatus?.completed || 0;
                document.getElementById('processingVideos').textContent = statsResponse.byStatus?.processing || 0;

                // è·å–ç”¨æˆ·æ€»æ•°
                const usersResponse = await apiCall('/users/all');
                document.getElementById('totalUsers').textContent = usersResponse.users?.length || 0;

                // è·å–æœ€è¿‘è§†é¢‘
                const videosResponse = await apiCall('/upload/my-uploads?limit=5');
                displayRecentVideos(videosResponse.videos || []);

                // è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€
                const healthResponse = await fetch(`${API_BASE.replace('/api', '')}/health`);
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    displaySystemHealth(healthData);
                }

            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºæœ€è¿‘è§†é¢‘
        function displayRecentVideos(videos) {
            const container = document.getElementById('recentVideosList');

            if (videos.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— è§†é¢‘</p>';
                return;
            }

            let html = '';
            videos.forEach(video => {
                const statusClass = `status-${video.status}`;
                const uploadTime = new Date(video.uploadTime).toLocaleDateString();

                html += `
                    <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                        <div>
                            <h6 class="mb-0">${video.title}</h6>
                            <small class="text-muted">${uploadTime}</small>
                        </div>
                        <span class="video-status ${statusClass}">${getStatusText(video.status)}</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ˜¾ç¤ºç³»ç»Ÿå¥åº·çŠ¶æ€
        function displaySystemHealth(health) {
            const container = document.getElementById('systemHealth');

            let html = `
                <div class="mb-2 d-flex justify-content-between">
                    <span>çŠ¶æ€:</span>
                    <span class="badge bg-success">${health.status}</span>
                </div>
            `;

            if (health.directories) {
                html += `
                    <div class="mt-3 pt-2 border-top">
                        <small class="text-muted">ç›®å½•çŠ¶æ€:</small>
                        <div class="mt-1">
                            <span class="badge ${health.directories.exists.videos ? 'bg-success' : 'bg-danger'}">è§†é¢‘ç›®å½•</span>
                            <span class="badge ${health.directories.exists.thumbnails ? 'bg-success' : 'bg-danger'}">ç¼©ç•¥å›¾ç›®å½•</span>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // åŠ è½½æˆ‘çš„ä¸Šä¼ 
        async function loadMyUploads() {
            try {
                const response = await apiCall('/upload/my-uploads');
                displayMyUploads(response.videos || []);
            } catch (error) {
                console.error('åŠ è½½æˆ‘çš„ä¸Šä¼ å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºæˆ‘çš„ä¸Šä¼ 
        function displayMyUploads(videos) {
            const container = document.getElementById('myUploadsList');

            if (videos.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— ä¸Šä¼ è®°å½•</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>æ ‡é¢˜</th><th>æ–‡ä»¶å</th><th>å¤§å°</th><th>çŠ¶æ€</th><th>ä¸Šä¼ æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';

            videos.forEach(video => {
                const statusClass = `status-${video.status}`;
                const uploadTime = new Date(video.uploadTime).toLocaleDateString();

                html += `
                    <tr>
                        <td>${video.title}</td>
                        <td>${video.originalName}</td>
                        <td>${video.size}</td>
                        <td><span class="video-status ${statusClass}">${getStatusText(video.status)}</span></td>
                        <td>${uploadTime}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="selectVideoForAnalysis(${video.id})">
                                <i class="fas fa-chart-bar"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info ms-1" onclick="playVideo('${video.filename}', '${video.title}')">
                                <i class="fas fa-play"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // åŠ è½½è§†é¢‘åˆ—è¡¨
        async function loadVideos() {
            try {
                const search = document.getElementById('searchVideos').value;
                const status = document.getElementById('filterStatus').value;

                // ç”±äºåç«¯æ²¡æœ‰ä¸“é—¨çš„æœç´¢APIï¼Œæˆ‘ä»¬ä½¿ç”¨ç°æœ‰APIç„¶ååœ¨å‰ç«¯è¿‡æ»¤
                const response = await apiCall('/upload/my-uploads');
                let videos = response.videos || [];

                // å‰ç«¯è¿‡æ»¤
                if (search) {
                    videos = videos.filter(video =>
                        video.title.toLowerCase().includes(search.toLowerCase()) ||
                        video.originalName.toLowerCase().includes(search.toLowerCase())
                    );
                }

                if (status) {
                    videos = videos.filter(video => video.status === status);
                }

                displayVideos(videos);
            } catch (error) {
                console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºè§†é¢‘åˆ—è¡¨
        function displayVideos(videos) {
            const container = document.getElementById('videosList');

            if (videos.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— è§†é¢‘</p>';
                return;
            }

            let html = '';
            videos.forEach(video => {
                const statusClass = `status-${video.status}`;
                const uploadTime = new Date(video.uploadTime).toLocaleDateString();

                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card video-card h-100">
                            <div class="video-thumbnail">
                                <i class="fas fa-video fa-3x text-muted"></i>
                            </div>
                            <span class="video-status ${statusClass}">${getStatusText(video.status)}</span>
                            <div class="card-body">
                                <h5 class="card-title">${video.title}</h5>
                                <p class="card-text text-muted small">${video.description || 'æš‚æ— æè¿°'}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">${uploadTime}</small>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary" onclick="selectVideoForAnalysis(${video.id})">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info ms-1" onclick="playVideo('${video.filename}', '${video.title}')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // é€‰æ‹©è§†é¢‘è¿›è¡Œåˆ†æ
        async function selectVideoForAnalysis(videoId) {
            try {
                // åˆ‡æ¢åˆ°åˆ†æé¡µé¢
                document.querySelector('.sidebar .nav-link[data-page="analysis"]').click();

                // è·å–è§†é¢‘è¯¦æƒ…
                const videoResponse = await apiCall(`/videos/${videoId}`);
                currentVideo = videoResponse.video;

                // æ˜¾ç¤ºè§†é¢‘å¯¹æ¯”
                displayVideoComparison(currentVideo);

                // åŠ è½½åˆ†æçŠ¶æ€
                loadAnalysisStatus(videoId);

            } catch (error) {
                console.error('é€‰æ‹©è§†é¢‘å¤±è´¥:', error);
                showMessage('åŠ è½½è§†é¢‘è¯¦æƒ…å¤±è´¥', 'error');
            }
        }

        // æ˜¾ç¤ºè§†é¢‘å¯¹æ¯”
        function displayVideoComparison(video) {
            const container = document.getElementById('videoComparison');

            const originalVideoUrl = `${API_BASE}/videos/stream/${video.filename}`;
            const annotatedVideoUrl = `${API_BASE}/videos/stream/${video.filename.replace('.mp4', '_annotated_h264.mp4')}`;

            container.innerHTML = `
                <div class="video-player-wrapper">
                    <div class="video-player-title">åŸå§‹è§†é¢‘</div>
                    <video controls>
                        <source src="${originalVideoUrl}" type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                    </video>
                </div>
                <div class="video-player-wrapper">
                    <div class="video-player-title">åˆ†æåè§†é¢‘</div>
                    <video controls>
                        <source src="${annotatedVideoUrl}" type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                    </video>
                </div>
            `;
        }

        // æ’­æ”¾è§†é¢‘
        function playVideo(filename, title) {
            const originalVideoPlayer = document.getElementById('originalVideoPlayer');
            const annotatedVideoPlayer = document.getElementById('annotatedVideoPlayer');
            const videoModalTitle = document.getElementById('videoModalTitle');

            const originalVideoUrl = `${API_BASE}/videos/stream/${filename}`;
            const annotatedVideoUrl = `${API_BASE}/videos/stream/${filename.replace('.mp4', '_annotated_h264.mp4')}`;

            originalVideoPlayer.src = originalVideoUrl;
            annotatedVideoPlayer.src = annotatedVideoUrl;
            videoModalTitle.textContent = title;

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));
            videoModal.show();
        }

        // åŠ è½½åˆ†æé¡µé¢
        async function loadAnalysisPage() {
            // å¦‚æœå·²ç»æœ‰é€‰ä¸­çš„è§†é¢‘ï¼Œæ˜¾ç¤ºå…¶åˆ†æçŠ¶æ€
            if (currentVideo) {
                loadAnalysisStatus(currentVideo.id);
            } else {
                // å¦åˆ™æ˜¾ç¤ºç”¨æˆ·è§†é¢‘åˆ—è¡¨ä¾›é€‰æ‹©
                const response = await apiCall('/upload/my-uploads');
                displayAnalysisVideoList(response.videos || []);
            }
        }

        // æ˜¾ç¤ºåˆ†æè§†é¢‘åˆ—è¡¨
        function displayAnalysisVideoList(videos) {
            const container = document.getElementById('analysisStatusList');

            if (videos.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— è§†é¢‘</p>';
                return;
            }

            let html = '<div class="list-group">';
            videos.forEach(video => {
                const statusClass = `status-${video.status}`;
                html += `
                    <a href="#" class="list-group-item list-group-item-action" onclick="selectVideoForAnalysis(${video.id})">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${video.title}</h6>
                            <span class="video-status ${statusClass}">${getStatusText(video.status)}</span>
                        </div>
                        <p class="mb-1">${video.originalName}</p>
                        <small>ä¸Šä¼ æ—¶é—´: ${new Date(video.uploadTime).toLocaleDateString()}</small>
                    </a>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // åŠ è½½åˆ†æçŠ¶æ€
        async function loadAnalysisStatus(videoId) {
            try {
                // è·å–è§†é¢‘åˆ†æè¯¦æƒ…
                const analysisResponse = await apiCall(`/videos/${videoId}/analysis`);
                displayAnalysisDetail(analysisResponse);

                // è·å–åˆ†æç»Ÿè®¡
                const statsResponse = await apiCall(`/analysis/${videoId}/stats`);
                displayAnalysisStats(statsResponse);

            } catch (error) {
                console.error('åŠ è½½åˆ†æçŠ¶æ€å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºåˆ†æè¯¦æƒ…
        function displayAnalysisDetail(analysisData) {
            const container = document.getElementById('analysisDetail');

            let html = `
                <h5>${analysisData.title}</h5>
                <p><strong>åˆ†æçŠ¶æ€:</strong> <span class="badge bg-success">${analysisData.analysisStatus}</span></p>
                <p><strong>åˆ†ææ—¶é—´:</strong> ${analysisData.analyzedAt ? new Date(analysisData.analyzedAt).toLocaleString() : 'æœªåˆ†æ'}</p>
            `;

            if (analysisData.summary) {
                html += `
                    <div class="mt-3">
                        <h6>åˆ†ææ‘˜è¦</h6>
                        <ul>
                            <li>åœºæ™¯æ•°é‡: ${analysisData.summary.sceneCount || 0}</li>
                            <li>å¯¹è±¡æ•°é‡: ${analysisData.summary.objectCount || 0}</li>
                            <li>ç½®ä¿¡åº¦: ${analysisData.summary.confidenceScore || 0}</li>
                            <li>è´¨é‡è¯„åˆ†: ${analysisData.summary.qualityScore || 0}</li>
                        </ul>
                    </div>
                `;
            }

            if (analysisData.content && analysisData.content.summary) {
                html += `
                    <div class="mt-3">
                        <h6>å†…å®¹åˆ†æ</h6>
                        <p>${analysisData.content.summary}</p>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // æ˜¾ç¤ºåˆ†æç»Ÿè®¡
        function displayAnalysisStats(statsData) {
            const container = document.getElementById('analysisStats');

            let html = '<h6>åˆ†æç»Ÿè®¡</h6>';

            if (statsData.stats) {
                html += `
                    <p>å¸§ç‡: ${statsData.stats.fps || 'N/A'}</p>
                    <p>æ€»å¸§æ•°: ${statsData.stats.total_frame || 'N/A'}</p>
                    <p>æ£€æµ‹äº‹ä»¶: ${statsData.events ? statsData.events.length : 0} ä¸ª</p>
                `;
            } else {
                html += '<p class="text-muted">æš‚æ— ç»Ÿè®¡ä¿¡æ¯</p>';
            }

            container.innerHTML = html;
        }

        // è§¦å‘åˆ†æ
        async function triggerAnalysis() {
            if (!currentVideo) {
                showMessage('è¯·å…ˆé€‰æ‹©è§†é¢‘', 'error');
                return;
            }

            try {
                const response = await apiCall(`/analysis/manual-trigger/${currentVideo.id}`, {
                    method: 'POST'
                });

                showMessage('åˆ†æä»»åŠ¡å·²æäº¤', 'success');

                // å¼€å§‹è½®è¯¢åˆ†æçŠ¶æ€
                startAnalysisPolling();

            } catch (error) {
                showMessage('æäº¤åˆ†æå¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¼€å§‹è½®è¯¢åˆ†æçŠ¶æ€
        function startAnalysisPolling() {
            if (analysisInterval) {
                clearInterval(analysisInterval);
            }

            analysisInterval = setInterval(() => {
                checkAnalysisStatus();
            }, 5000);
        }

        // æ£€æŸ¥åˆ†æçŠ¶æ€
        async function checkAnalysisStatus() {
            if (!currentVideo) return;

            try {
                // é‡æ–°åŠ è½½åˆ†æçŠ¶æ€
                await loadAnalysisStatus(currentVideo.id);

                // å¦‚æœåˆ†æå®Œæˆï¼Œåœæ­¢è½®è¯¢
                const analysisResponse = await apiCall(`/videos/${currentVideo.id}/analysis`);
                if (analysisResponse.analysisStatus === 'completed') {
                    clearInterval(analysisInterval);
                    showMessage('åˆ†æå®Œæˆ!', 'success');
                }

            } catch (error) {
                console.error('æ£€æŸ¥åˆ†æçŠ¶æ€å¤±è´¥:', error);
            }
        }

        // å¯¼å…¥åˆ†æç»“æœ
        async function importAnalysis() {
            if (!currentVideo) {
                showMessage('è¯·å…ˆé€‰æ‹©è§†é¢‘', 'error');
                return;
            }

            try {
                const response = await apiCall(`/analysis/${currentVideo.id}/import-from-files`, {
                    method: 'POST'
                });

                showMessage('åˆ†æç»“æœå¯¼å…¥æˆåŠŸ', 'success');
                loadAnalysisStatus(currentVideo.id);

            } catch (error) {
                showMessage('å¯¼å…¥åˆ†æç»“æœå¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤åˆ¶åˆ†ææ•°æ®åº“
        async function copyAnalysisDatabase() {
            if (!currentVideo) {
                showMessage('è¯·å…ˆé€‰æ‹©è§†é¢‘', 'error');
                return;
            }

            try {
                const response = await apiCall(`/analysis/${currentVideo.id}/copy-database`, {
                    method: 'POST'
                });

                showMessage('åˆ†ææ•°æ®åº“å¤åˆ¶æˆåŠŸ', 'success');
                loadAnalysisStatus(currentVideo.id);

            } catch (error) {
                showMessage('å¤åˆ¶åˆ†ææ•°æ®åº“å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½QwenAIåˆ†æé¡µé¢
        async function loadQwenAnalysisPage() {
            try {
                // åŠ è½½å·²å®Œæˆåˆ†æçš„è§†é¢‘
                const videosResponse = await apiCall('/upload/my-uploads');
                const completedVideos = (videosResponse.videos || []).filter(video => video.status === 'ready');
                populateVideoSelect(completedVideos);

            } catch (error) {
                console.error('åŠ è½½QwenAIåˆ†æé¡µé¢å¤±è´¥:', error);
            }
        }

        // å¡«å……è§†é¢‘é€‰æ‹©ä¸‹æ‹‰æ¡†
        function populateVideoSelect(videos) {
            const select = document.getElementById('qwenVideoSelect');

            let options = '<option value="">è¯·é€‰æ‹©è§†é¢‘</option>';
            videos.forEach(video => {
                options += `<option value="${video.id}">${video.title} (ID: ${video.id})</option>`;
            });

            select.innerHTML = options;
        }

        // å¼€å§‹QwenAIåˆ†æ
        async function startQwenAnalysis() {
            const videoId = document.getElementById('qwenVideoSelect').value;
            const analysisType = document.getElementById('analysisTypeSelect').value;

            if (!videoId) {
                showMessage('è¯·é€‰æ‹©è§†é¢‘', 'error');
                return;
            }

            try {
                const response = await apiCall(`/analysis/${videoId}/ai-analysis?analysisType=${analysisType}`);

                displayQwenAnalysisResult(response);
                showMessage('AIåˆ†æå®Œæˆ!', 'success');

            } catch (error) {
                showMessage('AIåˆ†æå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºQwenAIåˆ†æç»“æœ
        function displayQwenAnalysisResult(result) {
            const container = document.getElementById('qwenAnalysisResult');

            let html = `
                <h5>${result.videoTitle}</h5>
                <p><strong>åˆ†æç±»å‹:</strong> ${result.analysisType}</p>
                <p><strong>åˆ†ææ—¶é—´:</strong> ${new Date(result.timestamp).toLocaleString()}</p>
                
                <div class="mt-3">
                    <h6>AIåˆ†æç»“æœ</h6>
                    <div class="analysis-result">${result.qwenAnalysis}</div>
                </div>
            `;

            if (result.usage) {
                html += `
                    <div class="mt-3">
                        <h6>ä½¿ç”¨ç»Ÿè®¡</h6>
                        <p>æ€»Tokenæ•°: ${result.usage.total_tokens || 'N/A'}</p>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // å¼€å§‹æ‰¹é‡åˆ†æ
        async function startBatchAnalysis() {
            const analysisType = document.getElementById('batchAnalysisType').value;

            if (!analysisType) {
                showMessage('è¯·é€‰æ‹©åˆ†æç±»å‹', 'error');
                return;
            }

            try {
                // è·å–æ‰€æœ‰å·²å®Œæˆåˆ†æçš„è§†é¢‘
                const videosResponse = await apiCall('/upload/my-uploads');
                const completedVideos = (videosResponse.videos || []).filter(video => video.status === 'ready');

                if (completedVideos.length === 0) {
                    showMessage('æ²¡æœ‰å·²å®Œæˆåˆ†æçš„è§†é¢‘', 'warning');
                    return;
                }

                displayBatchAnalysisProgress(completedVideos, analysisType);
                showMessage('å¼€å§‹æ‰¹é‡åˆ†æ!', 'success');

                // é€ä¸ªè¿›è¡Œåˆ†æ
                for (let i = 0; i < completedVideos.length; i++) {
                    const video = completedVideos[i];
                    try {
                        await apiCall(`/analysis/${video.id}/ai-analysis?analysisType=${analysisType}`);
                        updateBatchAnalysisProgress(i + 1, completedVideos.length, true, video.title);
                    } catch (error) {
                        updateBatchAnalysisProgress(i + 1, completedVideos.length, false, video.title, error.message);
                    }

                    // å»¶è¿Ÿä¸€ä¸‹é¿å…è¯·æ±‚è¿‡å¿«
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

            } catch (error) {
                showMessage('æ‰¹é‡åˆ†æå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæ‰¹é‡åˆ†æè¿›åº¦
        function displayBatchAnalysisProgress(videos, analysisType) {
            const container = document.getElementById('batchAnalysisProgress');
            container.classList.remove('hidden');

            container.innerHTML = `
                <div class="alert alert-info">
                    <h6>æ‰¹é‡åˆ†æè¿›åº¦</h6>
                    <p>åˆ†æç±»å‹: ${analysisType}</p>
                    <p>æ€»è®¡: ${videos.length} ä¸ªè§†é¢‘</p>
                    <div id="batchProgressDetails"></div>
                </div>
            `;
        }

        // æ›´æ–°æ‰¹é‡åˆ†æè¿›åº¦
        function updateBatchAnalysisProgress(current, total, success, videoTitle, error = '') {
            const detailsContainer = document.getElementById('batchProgressDetails');

            const statusIcon = success ? 'âœ…' : 'âŒ';
            const statusText = success ? 'æˆåŠŸ' : `å¤±è´¥: ${error}`;

            const progressItem = document.createElement('div');
            progressItem.innerHTML = `${statusIcon} ${videoTitle} - ${statusText} (${current}/${total})`;
            progressItem.className = 'small';

            detailsContainer.appendChild(progressItem);
        }

        // å·¥å…·å‡½æ•°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getStatusText(status) {
            const statusMap = {
                'uploading': 'ä¸Šä¼ ä¸­',
                'processing': 'å¤„ç†ä¸­',
                'ready': 'å°±ç»ª',
                'error': 'é”™è¯¯'
            };
            return statusMap[status] || status;
        }
        function displayAnalysisDetail(analysisData) {
            const container = document.getElementById('analysisDetail');

            let html = `
        <h5>${analysisData.title}</h5>
        <p><strong>åˆ†æçŠ¶æ€:</strong> <span class="badge bg-success">${analysisData.analysisStatus}</span></p>
        <p><strong>åˆ†ææ—¶é—´:</strong> ${analysisData.analyzedAt ? new Date(analysisData.analyzedAt).toLocaleString() : 'æœªåˆ†æ'}</p>
    `;

            if (analysisData.summary) {
                html += `
            <div class="mt-3">
                <h6>åˆ†ææ‘˜è¦</h6>
                <ul>
                    <li>åœºæ™¯æ•°é‡: ${analysisData.summary.sceneCount || 0}</li>
                    <li>å¯¹è±¡æ•°é‡: ${analysisData.summary.objectCount || 0}</li>
                    <li>ç½®ä¿¡åº¦: ${analysisData.summary.confidenceScore || 0}</li>
                    <li>è´¨é‡è¯„åˆ†: ${analysisData.summary.qualityScore || 0}</li>
                </ul>
            </div>
        `;
            }

            if (analysisData.content && analysisData.content.summary) {
                html += `
            <div class="mt-3">
                <h6>å†…å®¹åˆ†æ</h6>
                <p>${analysisData.content.summary}</p>
            </div>
        `;
            }

            container.innerHTML = html;

            // ç›´æ¥å¡«å……è¡¨æ ¼æ•°æ®ï¼ˆä½¿ç”¨å·²å­˜åœ¨çš„HTMLè¡¨æ ¼ï¼‰
            populateDetailedAnalysisTable(sampleDetailedResults);
        }

        function populateDetailedAnalysisTable(detailedResults) {
            const tableBody = document.getElementById('detailedAnalysisBody');
            const fpsElement = document.getElementById('analysisFPS');
            const totalFramesElement = document.getElementById('analysisTotalFrames');

            // æ¸…ç©ºè¡¨æ ¼
            tableBody.innerHTML = '';

            // è®¾ç½®è§†é¢‘ä¿¡æ¯
            if (detailedResults.fps) {
                fpsElement.textContent = detailedResults.fps.toFixed(2);
            }

            if (detailedResults.total_frame) {
                totalFramesElement.textContent = detailedResults.total_frame;
            }

            // éå†æ‰€æœ‰ç»„ä»¶ç±»å‹
            for (const [component, data] of Object.entries(detailedResults)) {
                // è·³è¿‡fpså’Œtotal_frameå±æ€§
                if (component === 'fps' || component === 'total_frame') continue;

                // ç›´æ¥ä½¿ç”¨æ•°æ®ï¼Œä¸éœ€è¦å†é€šè¿‡ç´¢å¼•è®¿é—®
                const startFrames = data[0];
                const durations = data[1];
                const endFrames = data[2];

                // ä¸ºæ¯ä¸ªæ—¶é—´æ®µåˆ›å»ºä¸€è¡Œ
                for (let i = 0; i < startFrames.length; i++) {
                    const row = document.createElement('tr');

                    // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ˜¾ç¤ºç»„ä»¶åç§°ï¼Œå¦åˆ™ç•™ç©º
                    const componentName = i === 0 ? component : '';

                    row.innerHTML = `
                <td>${componentName}</td>
                <td>${startFrames[i]}</td>
                <td>${durations[i]}</td>
                <td>${endFrames[i]}</td>
            `;

                    tableBody.appendChild(row);
                }
            }
        }
        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºç¤ºä¾‹æ•°æ®
        document.addEventListener('DOMContentLoaded', function () {
            const sampleAnalysisData = {
                title: 'åˆ†ææŠ¥å‘Š',
                analysisStatus: 'å·²å®Œæˆ',
                analyzedAt: new Date().toISOString(),
                summary: {
                    sceneCount: 18,
                    objectCount: 56,
                    confidenceScore: 0.87,
                    qualityScore: 0.92
                },
                content: {
                    summary: 'åˆ†æå®Œæˆï¼Œæ— é”™è¯¯ã€‚å†…å®¹åˆ†æå¯å€ŸåŠ©AIè¿›è¡Œã€‚'
                }
            };

            displayAnalysisDetail(sampleAnalysisData);
        });
        // ç¤ºä¾‹æ•°æ®
        const sampleDetailedResults = {
            "çº¢ç»†èƒ": [
                [230, 1990, 2740],
                [290, 30, 10],
                [520, 2020, 2750]
            ],
            "ç™½è¡€çƒ": [
                [680, 840],
                [130, 100],
                [810, 940]
            ],
            "è¡€å°æ¿": [
                [1180, 1450, 1630, 1750, 2030, 2090],
                [160, 140, 10, 50, 10, 20],
                [1340, 1590, 1640, 1800, 2040, 2110]
            ],
            "ç»†èƒè†œ": [
                [2760, 2870, 3030, 3090, 3150],
                [50, 120, 10, 30, 20],
                [2810, 2990, 3040, 3120, 3170]
            ],
            "æ°´": [
                [3120],
                [110],
                [3230]
            ],
            "æ°§": [
                [3140, 9000, 9140, 9240, 9400],
                [130, 70, 70, 20, 10],
                [3270, 9070, 9210, 9260, 9410]
            ],
            "è‘¡è„ç³–": [
                [3380, 3520, 3700, 3860, 3940],
                [50, 120, 100, 20, 70],
                [3430, 3640, 3800, 3880, 4010]
            ],
            "å¾®ä¸": [
                [5000],
                [130],
                [5130]
            ],
            "ä¸­é—´çº¤ç»´": [
                [5330, 5820, 6040],
                [10, 20, 10],
                [5340, 5840, 6050]
            ],
            "å¾®ç®¡": [
                [5500, 5850],
                [260, 280],
                [5760, 6130]
            ],
            "é©±åŠ¨è›‹ç™½": [
                [5760, 5960],
                [170, 40],
                [5930, 6000]
            ],
            "æ‰‹æŸ„": [
                [7190, 7650, 8410],
                [210, 10, 40],
                [7400, 7660, 8450]
            ],
            "ç»†èƒæ ¸": [
                [7220, 7510],
                [170, 10],
                [7390, 7520]
            ],
            "æ ¸è†œå­”": [
                [7670, 8080],
                [80, 30],
                [7750, 8110]
            ],
            "æ ¸ç³–æ ¸é…¸": [
                [9010, 9370, 9550],
                [330, 40, 190],
                [9340, 9410, 9740]
            ],
            "è„±æ°§æ ¸ç³–æ ¸é…¸": [
                [9400, 9710],
                [20, 30],
                [9420, 9740]
            ],
            "æ ¸ç³–ä½“": [
                [10260, 10850],
                [60, 10],
                [10320, 10860]
            ],
            "å›Šæ³¡": [
                [10630, 10720],
                [60, 90],
                [10690, 10810]
            ],
            "çº¿ç²’ä½“": [
                [10960, 11180, 11420, 11560, 11700, 11830],
                [90, 40, 90, 60, 20, 10],
                [11050, 11220, 11510, 11620, 11720, 11840]
            ],
            "fps": 22.061652281134403,
            "total_frame": 14910
        };

        // æµ‹è¯•ä»£ç  - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨éœ€è¦å°†sampleDetailedResultsæ›¿æ¢ä¸ºä»APIè·å–çš„æ•°æ®
        // populateDetailedAnalysisTable(sampleDetailedResults);
    </script>
</body>

</html>